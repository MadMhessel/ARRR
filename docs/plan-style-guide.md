# Плановый стиль ARRR

Документ фиксирует визуальные стандарты и рабочие правила для всех плановых шаблонов мебели и оборудования. Руководство применяется ко всем объектам из `templates.js` и к новым элементам, добавляемым в библиотеку.

## Палитра и линии

| Элемент                     | Значение                               |
|----------------------------|----------------------------------------|
| Контур предметов           | `#161A17`, толщина `1.4 px`            |
| Лёгкие детали              | `#161A17`, толщина `0.75 px`           |
| Центровые направляющие     | `#4E6B57`, пунктир `3/2`               |
| Заполнение помещений       | `rgba(118,168,132,0.18)`               |
| Контур стен                | определяется типом стены (`app.js`)    |

Все элементы используют `vector-effect: non-scaling-stroke`, поэтому толщины остаются стабильными при масштабировании и экспорте.

## Геометрия объектов

* Точка привязки каждого шаблона — геометрический центр (`cx = cy = 0`). Базовый габарит (`ow`, `oh`) соответствует реальному типоразмеру, что исключает сдвиги при масштабировании и повороте.
* Силуэт каждого предмета задаётся одной основной фигурой (`shape shape-fill`). Дополнительные линии, делящие поверхность, рисуются классом `.shape-detail`.
* Радиусы скруглений ограничены двумя значениями: крупный (≈15 % меньшей стороны) для внешнего контура и малый (≈6–8 % стороны) для внутренних деталей. Это обеспечивает единый визуальный ритм.
* Все размеры, заданные в `PLAN_LIBRARY`, указаны в сантиметрах и привязаны к кратности 5 см. Свойство `scaleStepCm` фиксирует рекомендуемый шаг изменения габаритов при ручном растяжении.

## Двери и проёмы

* Дверное полотно рисуется одной прямой линией толщиной `0.6–0.8 px` вдоль шарнира.
* Дуга открывания — четверть окружности шириной проёма. Параметры рассчитываются динамически в `renderWallComponentMarkup`, арка всегда имеет угол 90°.
* Цвет дуги и полотна наследует `OPENING_SPECS.door.stroke` (`#1A1D1A`).
* Для раздвижных или двустворчатых систем используется отдельный шаблон мебели; инструмент проёма создаёт только одинарную распашную дверь.

## Слои и порядок отрисовки

1. Сетка (`#grid-layer`).
2. Заливки помещений и штриховки (`shape-fill`).
3. Стены и проёмы (`#walls-layer`, маска `wallOpeningsMask`).
4. Стационарная мебель и оборудование.
5. Свободно стоящие предметы и декор.
6. Дуги открытия и вспомогательные символы.
7. Подписи, размеры, маркеры анализа.

## Типографика

* Основной шрифт: `Inter, Roboto, 'Segoe UI', system-ui`.
* Размер текста: 13–14 px для подписи предметов и панелей; 14 px для размеров; 18 px для заголовков.
* Все подписи располагаются параллельно плоскости плана. Никаких декоративных шрифтов, тени и outline запрещены.

## Масштабирование и трансформации

* Все шаблоны создаются с базовыми габаритами в `PLAN_LIBRARY`. При восстановлении старых проектов размеры пересчитываются через фактическую ширину/высоту, чтобы сохранить пропорции.
* `scaleStepCm` задаёт минимальный шаг изменения длины и высоты. Для длинных элементов (столешницы, перегородки) используется шаг 10 см, для мебели — 5 см, для приборов — фиксированный размер.
* Масштабирование всегда выполняется относительно центра объекта. Запрещено использовать встроенные трансформации внутри `svg` (`transform` у `.core`).

## Добавление нового шаблона

1. Добавьте запись в `PLAN_LIBRARY` (файл `templates.js`), указав `label`, `builder`, габариты, `scaleStepCm` и при необходимости `opts`.
2. Привяжите новый `id` к категории в `CATEGORY_ITEMS`.
3. Если шаблон заменяет старый элемент, добавьте пару `старый id → новый id` в `TEMPLATE_MIGRATION_MAP`.
4. При необходимости реализуйте новый `builder` (функция `build…`) или расширьте существующий `buildAppliance`/`buildStorage` опциями.
5. После определения данных вызов `registerTemplate` создаст `svg` и `schematicSvg` варианты автоматически.
6. Обновите документацию: таблицу миграции и перечень типоразмеров, если добавлен новый стандарт.

## Принципы визуальной простоты

* Максимум две внутренние линии на предмет (деление сидений, столешниц, полок).
* Символика техники (конфорки, мойки, окна) — круги/прямоугольники одинаковой толщины.
* Никаких градиентов, теней, фильтров и эффектов SVG — только простые геометрические элементы.
* Палитра ограничена чёрно-зелёной гаммой: яркие цвета допустимы только для подсветки выбранных элементов интерфейсом, не в шаблонах.

## Контроль качества

* Печать: проверка читаемости в масштабах 1:50 и 1:100, экспорт в PDF должен сохранять одинаковые толщины линий.
* Производительность: план на 200+ объектов должен перерисовываться без «подвисаний». При необходимости уменьшайте количество узлов в `path`.
* Совместимость: при загрузке старых проектов `resolveTemplateId` автоматически подменяет идентификаторы на канонические. Следите за актуальностью таблицы миграции.

