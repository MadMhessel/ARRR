# Плановый стиль ARRR

Документ фиксирует каноническую стилизацию планов кофейни и распространяется на все шаблоны в `templates.js`. Ниже сведены правила, которые обеспечивают единый язык символов, читаемость в печати и совместимость со старыми сценами.

## 1. Визуальный язык

- **Контур**: насыщённый чёрный `#111111`, толщина 1.8 px для мебели и 3.2 px для капитальных стен. Контуры не масштабируются (`vector-effect: non-scaling-stroke`).
- **Детали**: холодный серый `#676D72`, толщина 1.0 px. Используются для внутренних осей, дуг дверей, штриховки стекла и сервисных обозначений.
- **Заливка помещений**: ровный тон `#EAF3E7` без градиентов и шумов. Выбор цвета синхронизирован с переменной `--fill-light` в `style.css`.
- **Грид и плитка**: сетка 90° `#DDE5E0` с непрозрачностью 0.55 и шагом, кратным 30–60 см (см. контрол `gridStep`).
- **Двери**: полотно и дуга открывания рисуются одной группой. Полотно — пунктир (dash 6/4), дуга — сплошная линия. Цвет наследует `OPENING_SPECS.door.stroke` (`#676D72`).
- **Текст**: шрифт Inter/Roboto, чёрный цвет, без засечек и эффектов. Жирное начертание и обводки запрещены.
- **Запрещено**: тени, градиенты, текстуры, SVG-фильтры на символах. В интерфейсе допускается подсветка выбора (`--ui-accent`).

## 2. Геометрия и привязки

- Рабочее поле шаблона — прямоугольник `[-w/2; w/2] × [-h/2; h/2]`. Силуэт и дуги на 100% внутри, отступ от границ ≥ 2 px.
- Центр (0;0) совпадает с точкой привязки и вращения. `registerTemplate()` добавляет `data-base-transform`, а `applyTransformFromDataset()` обеспечивает порядок трансформаций: центрирование → масштаб → базовый поворот.
- Стены и проёмы запрещено клипать; все маски предназначены только для ручек редактирования.

## 3. Порядок слоёв

1. Сетка (при включении).
2. Заливка помещений, тихие плиточные зоны.
3. Капитальные стены → перегородки → стекло/полустены.
4. Стационар: барные линии, сантехника, оборудование.
5. Свободная мебель и декор.
6. Дуги открывания, оси, сервисные штрихи.
7. Размеры, подписи, маркеры анализа.

## 4. Индивидуальные признаки категорий

### Посадка гостей

| Шаблон | Типоразмер | Отличительный признак |
| --- | --- | --- |
| `table-round-60/70/80` | Ø60/Ø70/Ø80 | Окружность + одиночная ось стойки.
| `table-rect-120x70/160x80/200x100/240x90` | 120×70 … 240×90 | Прямоугольник со скруглениями и двумя короткими осями на коротких сторонах.
| `table-hightop-round-70` | Ø70 | Двойная дуга у гостевой кромки (опция `frontArcs`).
| `table-work-160x80` | 160×80 | Поперечная ось по центру (опция `centerLine`).
| `chair-side-45x45` | 45×45 | Малый прямоугольник + линия спинки.
| `stool-round-35` / `stool-bar-35x35` | Ø35 / 35×35 | Чистый силуэт без спинки, центральная метка сиденья.
| `seat-banquette-120x60/160x60` | 120×60 / 160×60 | Посадочное поле + линия спинки вдоль длинной стороны.
| `seat-banquette-corner-180x180` | 180×180 | Г-образный контур `buildBanquetteCorner`, спинка по внутренним граням.
| `seat-booth-2-150x120` / `seat-booth-4-220x140` | ниши на 2/4 гостя | Короб с центральным столом и осью.

### Бар и кухонная линия

| Шаблон | Типоразмер | Признак |
| --- | --- | --- |
| `counter-straight-180/240` | 180×60 / 240×60 | Прямоугольник + рабочая кромка со стороны гостя.
| `counter-l-180x180` | 180×180 | Г-образная геометрия + две рабочие оси.
| `counter-island-180x90` | 180×90 | Прямоугольник + две параллельные детали.
| `counter-back-180x40` | 180×40 | Узкий модуль с горизонтальной полкой.
| `partition-linear-120x10` | 120×10 | Низкая перегородка со скруглением.

### Оборудование кофе-бара

| Шаблон | Признак |
| --- | --- |
| `appliance-espresso-80x60` / `110x60` | Прямоугольник, «стакан» (innerAlign='top'), полу дуги групп (`frontArcs`).
| `appliance-grinder-30x30` | Корпус + треугольный «бункер» и круг жёрнова.
| `appliance-batchbrew-80x45` | Верхняя зона с двумя кругами-кофейниками.
| `appliance-pourover-120x40` | Три стойки + две чаши вдоль оси.
| `appliance-undercounter-60x60` | Прямоугольник с верхним фасадом и вертикальной ручкой.
| `appliance-display-120x60` | Витрина, две полки (`horizontal`) и скошенное стекло (`frontArcs`).
| `appliance-milk-60x60`, `appliance-ice-60x60`, `appliance-counter-60x40`, `appliance-pos-35x35`, `appliance-cashdrawer-45x35` | Индивидуальные линии: ручки, щели, вертикальные метки.
| `fixture-condiment-120x35`, `fixture-syrup-90x30` | Частые вертикальные деления.

### Сантехника и уборка

| Шаблон | Признак |
| --- | --- |
| `kitchen-sink-60x60` / `kitchen-triple-sink-180x60` | Одна/несколько чаш `ellipse`, линия крана.
| `kitchen-handsink-50x50` | Компактная чаша + кран.
| `utility-mopsink-60x60` | Три диагонали, образующие решётку.
| `utility-floor-drain-15x15` | Малый квадрат + крест.
| `bath-sink-60x50`, `bath-toilet-38x70`, `bath-shower-90x90` | Изображения сантехники с характерными окружностями/стёклами.
| `appliance-washer-60x60`, `appliance-dryer-60x60` | Корпус + круглый люк.

### Хранение и инфраструктура

| Шаблон | Признак |
| --- | --- |
| `appliance-fridge-60x70`, `appliance-upright-70x70`, `appliance-freezer-60x60` | Фасад без внутренней вставки, вертикальная ручка (`handle`).
| `storage-wardrobe-120x60/180x60`, `storage-shelving-120x40` | Вертикальные деления и полки.
| `fixture-trash-40x40/80x40` | Контур + дуговая крышка (опция `paths`), у двойной — центральная перегородка.
| `fixture-drying-120x40` | Продольные ламели.
| `fixture-watercooler-40x60` | Корпус + две точки кнопок.
| `decor-plant-60`, `decor-planter-120x30` | Круглый горшок и S-лист / вытянутое кашпо.

### Сервис и оформление

`fixture-queuepost-35`, `fixture-menuboard-120x10`, `table-coffee-round-80`, `table-coffee-rect-120x60`, `storage-media-180x40`, `decor-floorlamp-45x45` поддерживают дополнительный сервис и читаются за счёт осей и внутренних линий.

## 5. Типоразмеры (см)

| Категория | Размеры |
| --- | --- |
| Столы | Ø60/70/80; 120×70; 160×80; 200×100; 240×90; хай-топ Ø70; рабочий стол 160×80.
| Посадка | Банкетки 120×60, 160×60, угловая 180×180; кабинки 150×120 и 220×140; табуреты Ø35 / 35×35; стул 45×45.
| Барные линии | Столешницы 180×60, 240×60; Г-образная 180×180; остров 180×90; задняя линия 180×40.
| Оборудование | Эспрессо 80×60 / 110×60; кофемолка 30×30; фильтр-брю 80×45; пуровер 120×40; ПММ 60×60; витрина 120×60; подстольный холодильник 60×60; напольный 70×70.
| Сантехника | Мойка 60×60; руки 50×50; тройная 180×60; мойка для швабры 60×60; трап 15×15; унитаз 70×38; душ 90×90; стиралка/сушилка 60×60.
| Инфраструктура | Холодильник 60×70; морозилка 60×60; стеллаж 120×40; мусор 40×40 / 80×40; кулер 40×60; растение Ø60.
| Проёмы | Дверь 80–90×200; двустворчатая 2×70–80; раздвижная 140; стеклянная 100.

Все изменения размеров кратны 5 см. В `PLAN_LIBRARY` параметр `scaleStepCm` фиксирует допустимый шаг.

## 6. Палитра, толщины, шрифты

| Элемент | Значение |
| --- | --- |
| Капитальные стены | Контур `#111111`, расчётная толщина 0.25 м (≈3.2 px).
| Перегородки | Толщина 0.16 м (≈2.1 px), тот же цвет; стекло — `#676D72` с штриховкой.
| Контур мебели | 1.8 px, цвет `#111111`.
| Детали, дуги, оси | 1.0 px, цвет `#676D72`, пунктир 6/4 для дверей.
| Плитка/сеточка | `#DDE5E0` с непрозрачностью 0.55.
| Текст | Inter/Roboto, 13–18 px на экране, при печати А3 — 9–11 pt.

## 7. Правила различимости

- В сцене не допускается два разных типа без уникальной метки. При необходимости добавляется микро-метка (2–3 буквы) в углу поля.
- Поворот/масштабирование не меняет расположение характерных деталей: дуги групп у кофемашины всегда по гостевой стороне, спинки банкеток — вдоль посадочной зоны.
- Проверяем читаемость: при масштабе 1:1 на экране и печати 1:100 распознаются ≥ 95% объектов из тестовой сцены (40+ элементов).

## 8. Совместимость и миграция

- Таблица соответствий старых ID зафиксирована в `docs/template-migration-map.md` и массиве `TEMPLATE_MIGRATION_MAP` (см. раздел 8 задания).
- При загрузке старых сцен `resolveTemplateId()` заменяет устаревшие ID (например, `table-rect-160x90` → `table-rect-160x80`). Если прямого аналога нет — выбирается ближайший тип и фиксируется в протоколе миграции.

## 9. Приёмка

1. **Необрезание**: ни одна линия/дуга не выходит за рабочее поле при зуме 100%.
2. **Центр**: `core.getBBox()` даёт центр, близкий к (0;0), трансформации не смещают символы.
3. **Читаемость**: в контрольной сцене из 250–300 объектов отрисовка плавная, стиль един.
4. **Экспорт**: PDF содержит чистый вектор; толщины соответствуют значениям в таблице выше.

## Добавление нового шаблона

1. Добавьте запись в `PLAN_LIBRARY`: ID, `builder`, габариты, `scaleStepCm`, `opts`.
2. Пропишите ID в `CATEGORY_ITEMS` и при необходимости в миграционной таблице.
3. Реализуйте или расширьте билдер (например, `buildAppliance` поддерживает `circles`, `frontArcs`, `paths`, `handle`).
4. Проверьте центрирование (`core.getBBox()`) и читаемость в масштабе 1:100.
5. Обновите документацию: каталог (`docs/coffee-plan-catalog.md`), визуальные эталоны и таблицу миграций.
