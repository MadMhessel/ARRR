# Протокол ревизии дверей и проёмов

## Исходные проблемы

- У всех дверных проёмов был жёстко зашит одинарный вариант, поэтому невозможно было задокументировать двустворчатые, раздвижные и стеклянные системы без ручного редактирования SVG.
- Параметры ширины, петли и направления не отображались в интерфейсе. Настройка происходила только во внутреннем состоянии и легко терялась при восстановлении сцен.
- Вспомогательные стили и градиенты в `index.html` создавали разнородные заливки, что противоречило требованию на чистый плановый стиль.
- Экспортированные сцены не имели демо-наборов «до/после», усложняя визуальную валидацию и регрессионные проверки.

## Выполненные изменения

- Добавлены четыре канонических варианта дверей (`single`, `double`, `sliding`, `glass`) с индивидуальными ограничениями по ширине, шагу и управлению петлёй/дугой. Все варианты централизованы в `DOOR_VARIANTS`, а нормализация обеспечивается функцией `normaliseDoorComponent`.
- В правой колонке появилась панель «Проём» с выпадающим списком вариантов, числовым полем ширины и радиокнопками для петли/направления. Панель автоматически скрывает недоступные параметры и синхронизируется с выбранным объектом.
- Логика обновления компонентов вынесена в `refreshComponentVisual`: любое изменение свойств немедленно перерисовывает дугу и положение проёма, устраняя сдвиги при поворотах и масштабировании.
- Удалены устаревшие градиенты/паттерны, подчёркивающие тени, чтобы SVG использовал только плоские силуэты с `vector-effect: non-scaling-stroke`.
- Добавлены демосцены `docs/demoscenes/before.json` и `docs/demoscenes/after.json`, отражающие состояние библиотеки до и после ревизии. Вторая сцена содержит 300+ элементов и полный набор дверей для нагрузочного теста.

## Проверки и выводы

- Проверена миграция: сцены без `variant`/`hinge`/`swing` автоматически получают настройки по умолчанию (`single`, петля слева, открывание внутрь). Значения сохраняются при повторной сериализации.
- Нагрузочный сценарий `after.json` обеспечивает плавную работу редактора на 300 объектах и подтверждает читаемость дуг и линий в масштабе 1:50/1:100 благодаря постоянным толщинам.
- Экспорт в PDF/SVG сохраняет ровные линии: все элементы используют обводку без трансформаций, что совместимо с векторным выводом печати.

## Рекомендации по дальнейшим шагам

- При добавлении новых вариантов дверей/проёмов расширяйте `DOOR_VARIANTS` и обновляйте документацию (`plan-style-guide.md`, таблицы миграции).
- Для дополнительных типов (гармошка, маятник) подготовьте отдельные шаблоны с уникальным обозначением, не перегружая существующий UI.
- Для автоматизированных проверок стоит добавить smoke-тест, который проходит по демосцене `after.json`, чтобы гарантировать целостность сериализации и отрисовки после будущих изменений.
